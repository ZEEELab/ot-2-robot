import json
from opentrons import protocol_api, types


TEST_TIPRACK_SLOT = '5'

RATE = 0.25  # % of default speeds
SLOWER_RATE = 0.1

PIPETTE_MOUNT = 'right'
PIPETTE_NAME = 'p1000_single'


TIPRACK_DEF_JSON = """{"ordering":[["A1","B1","C1","D1","E1","F1","G1","H1"],["A2","B2","C2","D2","E2","F2","G2","H2"],["A3","B3","C3","D3","E3","F3","G3","H3"],["A4","B4","C4","D4","E4","F4","G4","H4"],["A5","B5","C5","D5","E5","F5","G5","H5"],["A6","B6","C6","D6","E6","F6","G6","H6"],["A7","B7","C7","D7","E7","F7","G7","H7"],["A8","B8","C8","D8","E8","F8","G8","H8"],["A9","B9","C9","D9","E9","F9","G9","H9"],["A10","B10","C10","D10","E10","F10","G10","H10"],["A11","B11","C11","D11","E11","F11","G11","H11"],["A12","B12","C12","D12","E12","F12","G12","H12"]],"brand":{"brand":"biotix","brandId":["M-1000-9SC"]},"metadata":{"displayName":"Biotix 96 Tip Rack 1000 µL","displayCategory":"tipRack","displayVolumeUnits":"µL","tags":[]},"dimensions":{"xDimension":127.5,"yDimension":85.35,"zDimension":101.1},"wells":{"A1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":76.55,"z":19.28},"B1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":67.62,"z":19.28},"C1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":58.69,"z":19.28},"D1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":49.76,"z":19.28},"E1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":40.83,"z":19.28},"F1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":31.9,"z":19.28},"G1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":22.97,"z":19.28},"H1":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":16,"y":14.04,"z":19.28},"A2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":76.55,"z":19.28},"B2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":67.62,"z":19.28},"C2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":58.69,"z":19.28},"D2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":49.76,"z":19.28},"E2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":40.83,"z":19.28},"F2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":31.9,"z":19.28},"G2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":22.97,"z":19.28},"H2":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":24.93,"y":14.04,"z":19.28},"A3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":76.55,"z":19.28},"B3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":67.62,"z":19.28},"C3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":58.69,"z":19.28},"D3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":49.76,"z":19.28},"E3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":40.83,"z":19.28},"F3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":31.9,"z":19.28},"G3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":22.97,"z":19.28},"H3":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":33.86,"y":14.04,"z":19.28},"A4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":76.55,"z":19.28},"B4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":67.62,"z":19.28},"C4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":58.69,"z":19.28},"D4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":49.76,"z":19.28},"E4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":40.83,"z":19.28},"F4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":31.9,"z":19.28},"G4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":22.97,"z":19.28},"H4":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":42.79,"y":14.04,"z":19.28},"A5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":76.55,"z":19.28},"B5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":67.62,"z":19.28},"C5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":58.69,"z":19.28},"D5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":49.76,"z":19.28},"E5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":40.83,"z":19.28},"F5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":31.9,"z":19.28},"G5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":22.97,"z":19.28},"H5":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":51.72,"y":14.04,"z":19.28},"A6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":76.55,"z":19.28},"B6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":67.62,"z":19.28},"C6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":58.69,"z":19.28},"D6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":49.76,"z":19.28},"E6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":40.83,"z":19.28},"F6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":31.9,"z":19.28},"G6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":22.97,"z":19.28},"H6":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":60.65,"y":14.04,"z":19.28},"A7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":76.55,"z":19.28},"B7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":67.62,"z":19.28},"C7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":58.69,"z":19.28},"D7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":49.76,"z":19.28},"E7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":40.83,"z":19.28},"F7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":31.9,"z":19.28},"G7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":22.97,"z":19.28},"H7":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":69.58,"y":14.04,"z":19.28},"A8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":76.55,"z":19.28},"B8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":67.62,"z":19.28},"C8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":58.69,"z":19.28},"D8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":49.76,"z":19.28},"E8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":40.83,"z":19.28},"F8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":31.9,"z":19.28},"G8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":22.97,"z":19.28},"H8":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":78.51,"y":14.04,"z":19.28},"A9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":76.55,"z":19.28},"B9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":67.62,"z":19.28},"C9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":58.69,"z":19.28},"D9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":49.76,"z":19.28},"E9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":40.83,"z":19.28},"F9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":31.9,"z":19.28},"G9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":22.97,"z":19.28},"H9":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":87.44,"y":14.04,"z":19.28},"A10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":76.55,"z":19.28},"B10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":67.62,"z":19.28},"C10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":58.69,"z":19.28},"D10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":49.76,"z":19.28},"E10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":40.83,"z":19.28},"F10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":31.9,"z":19.28},"G10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":22.97,"z":19.28},"H10":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":96.37,"y":14.04,"z":19.28},"A11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":76.55,"z":19.28},"B11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":67.62,"z":19.28},"C11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":58.69,"z":19.28},"D11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":49.76,"z":19.28},"E11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":40.83,"z":19.28},"F11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":31.9,"z":19.28},"G11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":22.97,"z":19.28},"H11":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":105.3,"y":14.04,"z":19.28},"A12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":76.55,"z":19.28},"B12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":67.62,"z":19.28},"C12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":58.69,"z":19.28},"D12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":49.76,"z":19.28},"E12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":40.83,"z":19.28},"F12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":31.9,"z":19.28},"G12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":22.97,"z":19.28},"H12":{"depth":81.82,"totalLiquidVolume":1000,"shape":"circular","diameter":7.45,"x":114.23,"y":14.04,"z":19.28}},"groups":[{"metadata":{},"wells":["A1","B1","C1","D1","E1","F1","G1","H1","A2","B2","C2","D2","E2","F2","G2","H2","A3","B3","C3","D3","E3","F3","G3","H3","A4","B4","C4","D4","E4","F4","G4","H4","A5","B5","C5","D5","E5","F5","G5","H5","A6","B6","C6","D6","E6","F6","G6","H6","A7","B7","C7","D7","E7","F7","G7","H7","A8","B8","C8","D8","E8","F8","G8","H8","A9","B9","C9","D9","E9","F9","G9","H9","A10","B10","C10","D10","E10","F10","G10","H10","A11","B11","C11","D11","E11","F11","G11","H11","A12","B12","C12","D12","E12","F12","G12","H12"]}],"parameters":{"format":"irregular","quirks":[],"isTiprack":true,"tipLength":81.82,"isMagneticModuleCompatible":false,"loadName":"biotix_96_tiprack_1000ul"},"namespace":"custom_beta","version":1,"schemaVersion":2,"cornerOffsetFromSlot":{"x":0,"y":0,"z":0}}"""
TIPRACK_DEF = json.loads(TIPRACK_DEF_JSON)
TIPRACK_LABEL = TIPRACK_DEF.get('metadata', {}).get(
    'displayName', 'test labware')

metadata = {'apiLevel': '2.0'}


def run(protocol: protocol_api.ProtocolContext):
    tiprack = protocol.load_labware_from_definition(TIPRACK_DEF, TEST_TIPRACK_SLOT, TIPRACK_LABEL)
    pipette = protocol.load_instrument(
        PIPETTE_NAME, PIPETTE_MOUNT, tip_racks=[tiprack])

    num_cols = len(TIPRACK_DEF.get('ordering', [[]]))
    num_rows = len(TIPRACK_DEF.get('ordering', [[]])[0])


    def set_speeds(rate):
        protocol.max_speeds.update({
            'X': (600 * rate),
            'Y': (400 * rate),
            'Z': (125 * rate),
            'A': (125 * rate),
        })

        speed_max = max(protocol.max_speeds.values())

        for instr in protocol.loaded_instruments.values():
            instr.default_speed = speed_max

    set_speeds(RATE)
    firstwell = tiprack.well('A1')
    pipette.move_to(firstwell.top())
    protocol.pause("If the pipette is accurate click 'resume'")
    pipette.pick_up_tip()
    protocol.pause("If the pipette went into the center of the tip, click 'resume'")
    pipette.return_tip()
    protocol.pause("If the pipette successfully picked up the tip(s) but does not eject succesfully, pull the tip(s) off by hand and click 'resume'. Do not worry about tip ejection yet")

    last_col = (num_cols * num_rows) - num_rows
    if (PIPETTE_NAME == 'p20_multi_gen2' or PIPETTE_NAME == 'p300_multi_gen2'):
        well = tiprack.well(last_col)
        pipette.move_to(well.top())
        protocol.pause("If the position is accurate click 'resume'")
        pipette.pick_up_tip(well)
    else:
        last_well = (num_cols) * (num_rows)
        well = tiprack.well(last_well-1)
        pipette.move_to(well.top())
        protocol.pause("If the position is accurate click 'resume'")
        pipette.pick_up_tip(well)

    protocol.pause("If the pipette went to the center of the tip, click 'resume'")
    pipette.return_tip()
    protocol.comment("If the pipette successfully picked up the tip(s) but does not eject succesfully, pull the tip(s) off by hand and click 'resume'. Do not worry about tip ejection yet")

